# Requirements Draft (動画解析ツール)

## 1. ゴール
- 週あたりのプロジェクト作成数を計測できる状態で、動画アップロード→注釈保存→共有閲覧の一連を安定提供する。

## 2. ユーザーストーリー（現行優先）
1) オーナーはダッシュボードからプロジェクトを作成できる。
2) オーナーはプロジェクトに動画(<=500MB)をアップロードできる。
3) オーナーは動画上に描画/テキスト/番号を付け、JSONとして保存できる。
4) オーナーは任意の時点のスナップショット(png)を保存できる。
5) オーナーは共有リンクを生成し、ログイン不要の閲覧者が同じ動画と注釈を閲覧できる（編集不可）。
6) システムは無料ユーザーのデータ（動画/スナップショット/注釈）を7日後に削除する前に通知する。
7) システムはプロジェクト作成イベントをKPI計測用に記録できる（実装は後続）。

## 3. 機能要件
- プロジェクト
  - 作成上限: 無料ユーザー10件。超過時はエラーメッセージを返す。
- 動画アップロード
  - 1ファイル上限: 500MB。許可 MIME: mp4/quicktime/webm/ogg。
  - 保存先: public ディスク。
- 注釈/描画
  - JSONで保存。種別: pen/arrow/text/number、時刻と座標を持つ。
- スナップショット
  - png を public ディスクへ保存。時刻情報を保持。
- 共有
  - share_token で閲覧のみ。編集/保存系APIは利用不可。
- 自動削除
  - 対象: 動画/スナップショット/注釈。
  - 時期: 7日経過後。削除前に通知（チャネル/タイミングは未決）。
- 計測
  - プロジェクト作成イベントを記録（どこに記録するかは後決）。

## 4. 非機能要件
- 対応端末: 当面PC。モバイルは将来対応。
- 認証/認可: Fortify。編集はオーナーのみ。共有は未ログイン可の閲覧。
- ロギング/監査: 必要だが後回し。

## 5. 未決・要検討
- 削除前通知: メール or アプリ内通知、何日前に送るか。
- 計測基盤: 記録先（DB/外部分析ツール）と粒度。
- 将来プラン: 有料プランでの上限緩和/保存期間延長の具体値。

## 6. 受け入れ条件（現行スコープ）
- プロジェクト作成〜共有閲覧のhappy pathがPest Featureテストで通る。
- 500MB超の動画アップロードに対し、422 or バリデーションエラーを返す。
- 無料ユーザーで10件超の作成リクエストに対し、制限メッセージが返る。
- 共有リンクで編集系エンドポイントにアクセスすると拒否される（403/404）。
- 7日経過データの削除ジョブが存在し、対象レコード/ファイルが消える（通知仕様は決定後にテスト追加）。

