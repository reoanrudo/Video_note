# Tasks（動画解析ツール / Video Note）

このファイルは `.sdd/specs/video-analysis-tool/design.md` を実装可能な作業単位へ分解したもの。

## 1. 基盤/セットアップ

- [ ] Sail でのフロント実行を安定化（`node_modules` をコンテナボリュームへ分離済み）
  - 受け入れ: `./vendor/bin/sail npm run build` が成功する

## 2. プロジェクト（作成/上限）

- [ ] 無料ユーザーのプロジェクト作成上限（10件）を維持し、エラーメッセージを固定する
  - 受け入れ: 11件目の作成が失敗し、`name` にエラーが入る（Featureテスト）

## 3. 動画アップロード

- [ ] 500MB制限と許可MIMEのバリデーションを維持する
  - 受け入れ: 501MB相当でバリデーションエラー（Featureテスト）
  - 受け入れ: 期待するMIME以外でバリデーションエラー（必要ならテスト追加）

## 4. 注釈（JSON）保存

- [ ] `videos.annotations` の契約を `drawings/snapshots/settings` に統一し、保存/読み込みを安定させる
  - 受け入れ: 注釈保存APIでJSONが更新される（Featureテスト）

## 5. スナップショット（png）保存

- [ ] スナップショット保存APIの戻り値 `path` を **クライアントが annotations に永続化**する
  - 背景: 削除ジョブが `annotations.snapshots[*].path` を参照して削除するため
  - 受け入れ: スナップショット保存→注釈保存後、`videos.annotations.snapshots[*].path` が存在する（Featureテスト）

## 6. 共有（閲覧のみ）

- [ ] `GET /share/{token}` でログイン不要の閲覧を提供し、編集/保存系エンドポイントを拒否する
  - 受け入れ: 共有URLは200で表示される（Featureテスト）
  - 受け入れ: 共有閲覧者（未ログイン）が保存系ルートへアクセスした場合、302（ログインへ）を含む拒否挙動になる（Featureテストで固定）

## 7. 自動削除（7日）と通知

- [ ] 削除前通知（期限24時間前、メール）を維持し、キュー経由で送信できる
  - 受け入れ: `Notification::fake()` で対象ユーザーに通知される（Command/Featureテスト）
- [ ] 7日経過の動画/注釈/スナップショットを削除する
  - 受け入れ: `Storage::fake('public')` で動画ファイルが削除される
  - 受け入れ: `annotations.snapshots[*].path` にあるファイルが削除される
  - 受け入れ: `videos` レコードが削除される

## 8. KPI 計測（DB）

- [ ] プロジェクト作成イベントをDBへ記録できる
  - 受け入れ: プロジェクト作成時にイベントレコードが追加される（Featureテスト）
  - 受け入れ: 週次集計が可能な時刻（occurred_at相当）が保存される

## 9. プラン選択（将来用・制限解除なし）

- [ ] ユーザーがプランを選択し保存できる（制限は変わらない）
  - 受け入れ: 選択したプランが永続化される（Featureテスト）
  - 受け入れ: プランを変更してもプロジェクト上限/保持期間は変わらない（当面は全ユーザー無料扱い）
